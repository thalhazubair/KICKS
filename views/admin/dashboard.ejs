<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <title>Kicks - Admin Panel</title>
  <meta content="width=device-width, initial-scale=1.0" name="viewport">
  <meta content="" name="keywords">
  <meta content="" name="description">

  <!-- Favicon -->
  <link href="img/favicon.ico" rel="icon">

  <!-- Google Web Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Open+Sans:wght@400;600&family=Roboto:wght@500;700&display=swap"
    rel="stylesheet">

  <!-- Icon Font Stylesheet -->
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.10.0/css/all.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.4.1/font/bootstrap-icons.css" rel="stylesheet">

  <!-- Libraries Stylesheet -->
  <link href="/admin/lib/owlcarousel/assets/owl.carousel.min.css" rel="stylesheet">


  <!-- Customized Bootstrap Stylesheet -->
  <link href="/admin/css/bootstrap.min.css" rel="stylesheet">

  <!-- Template Stylesheet -->
  <link href="/admin/css/test.css" rel="stylesheet">
  <style>
    .active {
      color: rgb(34, 208, 141);
    }
  </style>
</head>

<body>
  <div class="container-fluid position-relative d-flex p-0">

    <!-- Sidebar Start -->
    <div class="sidebar pe-4 pb-3">
      <nav class="navbar bg-secondary navbar-dark">
        <a href="#" class="navbar-brand mx-4 mb-3">
          <h3 class="text-primary"><i class="fa fa-user-edit me-2"></i>KICKS </h3>
        </a>
        <div class="d-flex align-items-center ms-4 mb-4">
          <div class="position-relative">
            <img class="rounded-circle" src="img/user.jpg" alt="" style="width: 40px; height: 40px;">
            <div class="bg-success rounded-circle border border-2 border-white position-absolute end-0 bottom-0 p-1">
            </div>
          </div>
          <div class="ms-3">
            <h6 class="mb-0">Thalha</h6>
            <span>Admin</span>
          </div>
        </div>
        <div class="navbar-nav w-100">
          <a href="/admin" class="nav-item nav-link active"><i class="fa fa-tachometer-alt me-2"></i>Dashboard</a>
          <a href="/admin/orderDetails" class="nav-item nav-link"><i class="fa fa-th me-2"></i>Orders</a>
          <a href="/admin/product" class="nav-item nav-link"><i class="fa fa-keyboard me-2"></i>Products</a>
          <a href="/admin/Category" class="nav-item nav-link"><i class="fa fa-table me-2"></i>Category</a>
          <!-- <a href="chart.html" class="nav-item nav-link"><i class="bi bi-bag-plus-fill me-2"></i>Add Products</a> -->
          <a href="/admin/table" class="nav-item nav-link"><i class="bi bi-people me-2"></i>Users</a>
          <a href="/admin/coupon" class="nav-item nav-link"><i class="bi bi-cash me-2"></i>Coupon</a>
        </div>
      </nav>
    </div>
    <!-- Sidebar End -->


    <!-- Content Start -->
    <div class="content">
      <!-- Navbar Start -->
      <nav class="navbar navbar-expand bg-secondary navbar-dark sticky-top px-4 py-0">
        <a href="index.html" class="navbar-brand d-flex d-lg-none me-4">
          <h2 class="text-primary mb-0"><i class="fa fa-user-edit"></i></h2>
        </a>
        <a href="#" class="sidebar-toggler flex-shrink-0">
          <i class="fa fa-bars"></i>
        </a>

        <div class="navbar-nav align-items-center ms-auto">
          <div class="nav-item dropdown">
            <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown">
              <img class="rounded-circle me-lg-2" src="img/user.jpg" alt="" style="width: 40px; height: 40px;">
              <span class="d-none d-lg-inline-flex">Thalha</span>
            </a>
            <div class="dropdown-menu dropdown-menu-end bg-secondary border-0 rounded-0 rounded-bottom m-0">
              <!-- <a href="#" class="dropdown-item">My Profile</a>
                            <a href="#" class="dropdown-item">Settings</a> -->
              <a href="/admin/logout" class="dropdown-item">Log Out</a>
            </div>
          </div>
        </div>
      </nav>
      <!-- Navbar End -->
      <!-- </div> -->
      <!-- Content End -->
      <!-- </div> -->

      <!-- JavaScript Libraries -->
      <script src="https://code.jquery.com/jquery-3.4.1.min.js"></script>
      <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0/dist/js/bootstrap.bundle.min.js"></script>

      <script src="/admin/lib/chart/chart.min.js"></script>
      <script src="/admin/lib/easing/easing.min.js"></script>
      <script src="/admin/lib/waypoints/waypoints.min.js"></script>
      <script src="/admin/lib/owlcarousel/owl.carousel.min.js"></script>
    

      <!-- Template Javascript -->
      <script src="/admin/js/main.js"></script>



      <!-- Sale & Revenue Start -->
      <div class="container-fluid pt-4 px-4">
        <div class="row g-4">
          <div class="col-sm-6 col-xl-3">
            <div class="bg-secondary rounded d-flex align-items-center justify-content-between p-4">
              <i class="fa fa-chart-line fa-3x text-primary"></i>
              <div class="ms-3">
                <p class="mb-2">Today Sale</p>
                <h6 class="mb-0">$<%= totalAmountToday %>
                </h6>
              </div>
            </div>
          </div>
          <div class="col-sm-6 col-xl-3">
            <div class="bg-secondary rounded d-flex align-items-center justify-content-between p-4">
              <i class="fa fa-chart-bar fa-3x text-primary"></i>
              <div class="ms-3">
                <p class="mb-2">Total Sale</p>
                <h6 class="mb-0">$<%= totalAmount %>
                </h6>
              </div>
            </div>
          </div>
          <div class="col-sm-6 col-xl-3">
            <div class="bg-secondary rounded d-flex align-items-center justify-content-between p-4">
              <i class="fa fa-chart-area fa-3x text-primary"></i>
              <div class="ms-3">
                <p class="mb-2">Today Order</p>
                <h6 class="mb-0">
                  <%= todayOrder %>
                </h6>
              </div>
            </div>
          </div>
          <div class="col-sm-6 col-xl-3">
            <div class="bg-secondary rounded d-flex align-items-center justify-content-between p-4">
              <i class="fa fa-chart-pie fa-3x text-primary"></i>
              <div class="ms-3">
                <p class="mb-2">Total Order</p>
                <h6 class="mb-0">
                  <%= allOrders %>
                </h6>
              </div>
            </div>
          </div>
        </div>
      </div>
      <!-- Sale & Revenue End -->

      <!-- Chart Start -->
      <div class="container-fluid pt-4 px-4">
        <div class="row g-4">
          <div class="col-sm-12 col-xl-6">
            <div class="bg-secondary rounded h-100 p-4">
              <h6 class="mb-4">Single Line Chart</h6>
              <input type="hidden" value="<%= cashOnDelivery %>" id="cod" />
              <input type="hidden" value="<%= onlinePayment %>" id="razorpay" />
              <canvas id="line-chart"></canvas>
            </div>
          </div>
          <div class="col-sm-12 col-xl-6">
            <div class="bg-secondary rounded h-100 p-4">
              <h6 class="mb-4">Single Line Chart</h6>
              <input type="hidden" value="<%= shipped %>" id="shipped" />
              <input type="hidden" value="<%= delivered %>" id="delivered" />
              <input type="hidden" value="<%= cancelled %>" id="cancelled" />
              <input type="hidden" value="<%= pending %>" id="pending" />
              <canvas id="status-chart"></canvas>
            </div>
          </div>
        </div>
      </div>
      <!-- Chart End -->

      <!-- Recent Sales Start -->
      <div class="container-fluid pt-4 px-4">
        <div class="bg-secondary text-center rounded p-4">
          <div class="d-flex align-items-center justify-content-between mb-4">
            <h6 class="mb-0">Sales Report</h6>

          </div>

          <form action="/admin/salesFilter" method="post" class="d-flex">
            <div class="justify-content-center">
              <label for="from">From:</label>
              <input type="date" name="from" class="form-control bg-white" />
            </div>
            <div class="justify-content-center ml-2">
              <label for="to">To:</label>
              <input type="date" name="to" class="form-control bg-white" />


              <button type="submit" class="btn btn-outline-light mb-2 mt-2 d-flex align-items-center"
                style="border-radius: 10px; background-color: #d1dce5;">
                <span class="fa fa-search"></span>
              </button>

            </div>
          </form>

          <div class="table-responsive html-content">
            <table class="table text-start align-middle table-bordered table-hover mb-0">
              <thead>
                <tr class="text-success">
                  <th scope="col">Order Date</th>
                  <th scope="col">name</th>
                  <th scope="col">Payment<br>Method</th>
                  <th scope="col">Payment<br>Status</th>
                  <th scope="col">Order<br>Status</th>
                  <th scope="col">Amount</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <% data.forEach((order)=>{ %>
                    <td>
                      <%= order.orderDate %>
                    </td>
                    <td>
                      <%= order.name %>
                    </td>
                    <td>
                      <%= order.paymentMethod %>
                    </td>
                    <td>
                      <%= order.paymentStatus %>
                    </td>
                    <td>
                      <%= order.orderStatus %>
                    </td>
                    <td> $<%= order.totalAmount %>
                    </td>
                </tr>
                <%})%>
              </tbody>
            </table>
            <% data.forEach((order)=>{ %>
              <div id="modalRegister-<%= order._id %>" class="modal fade" role="dialog">
                <div class="modal-dialog modal-dialog-centered">
                  <!-- Modal content-->
                  <div class="modal-content">
                    <div class="modal-header">
                      <button type="button" class="close" data-dismiss="modal">&times;</button>
                    </div>
                    <div class="modal-body">
                      <form action="/admin/changeStatus/<%= order._id %>" method="post">
                        <div class="mb-3">
                          <label for="recipient-name" name="orderStatus" class="col-form-label">
                            Order Status
                          </label>
                          <select class="form-select" name="orderStatus" aria-label="Default select example">
                            <option selected>
                              <%= order.orderStatus %>
                            </option>
                            <option value="pending" name="orderStatus">Pending</option>
                            <option value="shipped" name="orderStatus">Shipped</option>
                            <option value="delivered" name="orderStatus">Delivered</option>
                            <option value="Cancelled" name="orderStatus">Cancelled</option>
                          </select>
                        </div>
                        <div class="mb-3">
                          <label for="message-text" name="paymentStatus" class="col-form-label">Payment Status</label>
                          <select class="form-select" name="paymentStatus" aria-label="Default select example">
                            <option selected>
                              <%= order.paymentStatus %>
                            </option>
                            <option value="not paid" name="paymentStatus">not paid</option>
                            <option value="paid" name="paymentStatus">paid</option>
                          </select>
                        </div>
                        <div class="modal-footer">
                          <button type="submit" value="submit" class="btn btn-primary">
                            confirm
                          </button>
                        </div>
                      </form>
                    </div>
                    <div class="modal-footer">
                      <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                    </div>
                  </div>
                </div>
              </div>
              <% }) %>
          </div>
          <button class="mt-3" onclick="CreatePDFfromHTML()">Generate PDF</button>
          <button class="mt-3" onclick="downloadExcel()">Download Excel</button>
        </div>
      </div>
      <!-- Recent Sales End -->
      <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/1.5.3/jspdf.min.js"></script>
      <script type="text/javascript" src="https://html2canvas.hertzen.com/dist/html2canvas.js"></script>
      <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.0/jquery.min.js"></script>
      <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js"></script>
      <script src="https://cdn.jsdelivr.net/npm/chart.js@3.5.1/dist/chart.min.js"></script>
      <script>

        function CreatePDFfromHTML() {
          var HTML_Width = $(".html-content").width();
          var HTML_Height = $(".html-content").height();
          var top_left_margin = 15;
          var PDF_Width = HTML_Width + (top_left_margin * 2);
          var PDF_Height = (PDF_Width * 1.5) + (top_left_margin * 2);
          var canvas_image_width = HTML_Width;
          var canvas_image_height = HTML_Height;

          var totalPDFPages = Math.ceil(HTML_Height / PDF_Height) - 1;

          html2canvas($(".html-content")[0]).then(function (canvas) {
            var imgData = canvas.toDataURL("image/jpeg", 1.0);
            var pdf = new jsPDF('p', 'pt', [PDF_Width, PDF_Height]);
            pdf.addImage(imgData, 'JPG', top_left_margin, top_left_margin, canvas_image_width, canvas_image_height);
            for (var i = 1; i <= totalPDFPages; i++) {
              pdf.addPage(PDF_Width, PDF_Height);
              pdf.addImage(imgData, 'JPG', top_left_margin, -(PDF_Height * i) + (top_left_margin * 4), canvas_image_width, canvas_image_height);
            }
            pdf.save("Your_PDF_Name.pdf");
            $(".html-content");
          });
        }
      </script>

      <script>
        $("#kt_daterangepicker_1").daterangepicker();

      </script>

      <script>
        let cod = document.getElementById("cod").value;
        let razorpay = document.getElementById("razorpay").value;
        var ctx6 = document.getElementById("line-chart").getContext("2d");
        var myChart6 = new Chart(ctx6, {
          type: "bar",
          data: {
            labels: ["COD", "Razorpay"],
            datasets: [
              {
                backgroundColor: ["#C2C9C8", "#515454"],
                data: [cod, razorpay],
              },
            ],
          },
          options: {
            responsive: true,
          },
        });
      </script>
      <script>
        let shipped = document.getElementById("shipped").value;
        let delivered = document.getElementById("delivered").value;
        let cancelled = document.getElementById("cancelled").value;
        let pending = document.getElementById("pending").value;
        var ctx6 = document.getElementById("status-chart").getContext("2d");
        var myChart6 = new Chart(ctx6, {
          type: "bar",
          data: {
            labels: ["Shipped", "Deliverd", "Cancelled", "Pending"],
            datasets: [
              {
                backgroundColor: ["#C2C9C8", "#515454", "#C2B9C5", "#C3E9C2"],
                data: [shipped, delivered, cancelled, pending],
              },
            ],
          },
          options: {
            responsive: true,
          },
        });
      </script>

      <script>
        const rows = document.querySelectorAll('table tbody tr');
        const data = [];

        for (const row of rows) {
          const cells = row.querySelectorAll('td');
          const record = {};


          record.name = cells[1].textContent;
          record.paymentMethod = cells[2].textContent;
          record.paymentStatus = cells[3].textContent;
          record.orderStatus = cells[4].textContent;
          record.amount = cells[5].textContent;

          data.push(record);
        }

        const formattedData = data.map((record) => {
          const formattedRecord = {};


          formattedRecord.name = record.name;
          formattedRecord.paymentMethod = record.paymentMethod;
          formattedRecord.paymentStatus = record.paymentStatus;
          formattedRecord.orderStatus = record.orderStatus;
          formattedRecord.amount = record.amount;

          return formattedRecord;
        });


        const header = ['Name', 'Payment Method', 'Payment Status', 'Order Status', 'Amount'];
        const rowss = formattedData.map((record) => [

          record.name,
          record.paymentMethod,
          record.paymentStatus,
          record.orderStatus,
          record.amount
        ]);

        const csvContent =
          'data:text/csv;charset=utf-8,' +
          header.join(',') +
          '\n' +
          rowss.map((row) => row.join(',')).join('\n');


        function downloadExcel() {

          const encodedUri = encodeURI(csvContent);
          const link = document.createElement('a');
          link.href = encodedUri;;
          link.download = 'orders.csv';
          link.click();
        }
      </script>

</body>

</html>